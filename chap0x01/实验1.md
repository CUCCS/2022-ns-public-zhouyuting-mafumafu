# 基于 VirtualBox 的网络攻防基础环境搭建

## 实验目的

- 掌握 VirtualBox 虚拟机的安装与使用；
- 掌握 VirtualBox 的虚拟网络类型和按需配置；
- 掌握 VirtualBox 的虚拟硬盘多重加载；

## 实验要求
- [x] 虚拟硬盘配置成多重加载；
- [x] 搭建满足如下拓扑图所示的虚拟机网络拓扑；
![](img/example.jpg)
- [x] 完成以下网络连通性测试；
    - [x] 靶机可以直接访问攻击者主机
    - [x] 攻击者主机无法直接访问靶机
    - [x] 网关可以直接访问攻击者主机和靶机
    - [x] 靶机的所有对外上下行流量必须经过网关
    - [x] 所有节点均可以访问互联网

## 实验环境
**1.虚拟机**
- 攻击者主机（Attacker）：kali-attacker
- 网关（Gateway, GW）：Debian-gw
- 靶机（Victim）：
    - intnet1:
    kali-victim;xp3-victim1
    - intnet2:
    debian-victim;xp3-victim2

**2.网络配置**

* 网关网卡配置：
![](img/debian-gw-net.png)<br/>

* 攻击者主机配置：
![](img/kali-attacker-net.png)<br/>

* 靶机debian-victim配置：
![](img/debian-victim-net.png)<br/>

* 靶机kali-victim配置：
![](img/kali-victim-net.png)<br/>

* 靶机xp3-victim1配置：
![](img/xp-victim1-net.png)<br/>

* 靶机xp3-victim2配置：
![](img/xp-victim2-net.png)<br/>

注意：此处修改xp系统控制芯片为：PCnet-FAST III。
![](img/change.png)<br/>

**3.虚拟机ip地址**

|      名称      |       ip地址       |
| :------------: | :---------------: |
|   Debian-gw    |   10.0.2.4/24    |
|                | 169.254.63.218/16 |
|                |  172.16.111.1/24  |
|                |  172.16.222.1/24  |
| kali-attacker  |   10.0.2.15/24    |
|  kali-victim   | 172.16.111.144/24 |
|  xp3-victim1   | 172.16.111.134/24 |
|  xp3-victim2   | 172.16.222.148/24 |
| debian-victim  | 172.16.222.149/24 |

## 实验要求
### 虚拟硬盘设置多重加载
因事先已经导入了虚拟硬盘，所以首先打开虚拟介质管理，将指定虚拟硬盘设置类型为多重加载：<br/>
![](img/multiple-loading2.jpg)<br/>
![](img/multiple-loading3.png)<br/>
利用多重加载配置虚拟机：<br/>
![](img/mutiple-set.jpg)<br/>

### 网络拓扑图
![](img/picture.png)<br/>

### 网络连通性测试

**靶机可以直接访问攻击者主机**<br/>

debian-victim靶机访问攻击者主机：
![](img/debianvic-ping-attacker.png)<br/>
kali-victim靶机访问攻击者主机：
![](img/kalivic-ping-attacker.png)<br/>
xp3-victim1靶机访问攻击者主机:
![](img/xp1-ping-attacker.png)<br/>
xp3-victim1靶机访问攻击者主机:
![](img/xp2-ping-attacker.png)<br/>

**攻击者主机无法直接访问靶机**<br/>
![](img/kaliattacker-ping-target.png)<br/>
![](img/kaliattacker-ping-target2.png)<br/>

**网关可以直接访问攻击者主机和靶机**<br/>
网关访问攻击者主机：
![](img/gw-ping-attacker.png)<br/>
网关访问debian-victim:
![](img/gw-ping-debianvic.png)<br/>
网关访问kali-victim:
![](img/gw-ping-kalivic.png)<br/>
网关访问xp3-victim1:
![](img/gw-ping-xp1.png)<br/>
网关访问xp3-victim2:
![](img/gw-ping-xp2.png)<br/>

**靶机的所有对外上下行流量必须经过网关**<br/>
通过查看网关的DNS日志记录观察靶机流量是否经过网关：
![](img/gw-taillog.png)<br/>
debian-victim上下行流量经过网关：
![](img/debianvic-flow.png)<br/>
kali-victim上下行流量经过网关：
![](img/kalivic-flow.png)<br/>
xp3-victim1上下行流量经过网关：
![](img/xp1-flow.png)<br/>
xp3-victim2上下行流量经过网关：
![](img/xp2-flow.png)<br/>

**所有节点均可以访问互联网**<br/>
通过ping百度网站的方式测试是否能够连接互联网：<br/>
攻击者主机kali-attacker连接互联网：
![](img/online-kaliattacker.png)<br/>
网关Debian-gw连接互联网：
![](img/online-gw.png)
debian-victim连接互联网：
![](img/online-debianvic.png)<br/>
kali-victim连接互联网：
![](img/online-kalivic.png)<br/>
xp3-victim1连接互联网：
![](img/online-xp1.png)<br/>
xp3-victim2连接互联网：
![](img/online-xp2.png)<br/>


### 遇到问题与解决办法
在网关连接两个xp靶机时最初出现了无法联通的现象：<br/>
![](img/gw-ping-xp-problem1.png)<br/>
通过相关资料搜索以及询问，问题在于防火墙，点击右下角windows安全中心，打开windows防火墙里的ICMP设置，允许传入回显请求，最后确定即可。<br/>
![](img/gw-ping-xp-solve1.png)<br/>
![](img/gw-ping-xp-solve2.png)<br/>

### 参考资料

[2021-ns-public-luminous-123](https://github.com/CUCCS/2021-ns-public-luminous-123/blob/chap0x01/chap0x01/Chap0x01%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A.md)<br/>